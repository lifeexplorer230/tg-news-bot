# ๐ฐ Universal News Digest Bot

**ะะตััะธั 3.0** | โ Production Ready | ๐ ะฃะฝะธะฒะตััะฐะปัะฝะฐั ะฟะปะฐััะพัะผะฐ

ะะฒัะพะผะฐัะธัะตัะบะธะน ะฐะณัะตะณะฐัะพั ะฝะพะฒะพััะตะน ะธะท Telegram-ะบะฐะฝะฐะปะพะฒ ั ะฟะพะดะดะตัะถะบะพะน **ะปัะฑัั ะบะฐัะตะณะพัะธะน**. ะะฐัะธะฝะฐั ั ะฒะตััะธะธ 3.0 ะฑะพั ะฟะพะปะฝะพัััั ัะฝะธะฒะตััะฐะปะตะฝ: ะฒั ะผะพะถะตัะต ะฝะฐัััะพะธัั ะตะณะพ ะดะปั ะผะฐัะบะตัะฟะปะตะนัะพะฒ, AI, ะบัะธะฟัะพะฒะฐะปัั, ัะตัะฝะพะปะพะณะธะน ะธะปะธ ะปัะฑะพะน ะดััะณะพะน ัะตะผะฐัะธะบะธ ัะตัะตะท ัะธััะตะผั ะฟัะพัะธะปะตะน.

## ๐ฏ ะะพะทะผะพะถะฝะพััะธ

- **ะฃะฝะธะฒะตััะฐะปัะฝะฐั ัะธััะตะผะฐ ะบะฐัะตะณะพัะธะน** - ะฝะฐัััะพะนัะต ะปัะฑัะต ะบะฐัะตะณะพัะธะธ ะฝะพะฒะพััะตะน (ะผะฐัะบะตัะฟะปะตะนัั, AI, ะบัะธะฟัะพ, tech ะธ ั.ะด.)
- **ะัะพัะธะปะธ ะบะพะฝัะธะณััะฐัะธะธ** - ะฑััััะพะต ะฟะตัะตะบะปััะตะฝะธะต ะผะตะถะดั ัะฐะทะฝัะผะธ ะฝะฐะฑะพัะฐะผะธ ะฝะฐัััะพะตะบ (marketplace, ai, generic)
- **ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฑะพั** ะฝะพะฒะพััะตะน ะธะท ัะพัะตะฝ Telegram ะบะฐะฝะฐะปะพะฒ
- **AI-ะฐะฝะฐะปะธะท ัะตัะตะท Gemini** - ะพัะฑะพั ัะฐะผัั ะฒะฐะถะฝัั ะฝะพะฒะพััะตะน ั ััะตัะพะผ ะบะฐัะตะณะพัะธะน
- **ะะธะฑะบะฐั ะฟัะฑะปะธะบะฐัะธั** - ะพะดะธะฝ ะธะปะธ ะฝะตัะบะพะปัะบะพ ะบะฐะฝะฐะปะพะฒ, ะฝะฐัััะพะนะบะฐ ะฟะพะด ะบะฐะถะดัั ะบะฐัะตะณะพัะธั
- **ะัะพะฒะตัะบะฐ ะดัะฑะปะธะบะฐัะพะฒ** ัะตัะตะท embeddings
- **ะะพะดะตัะฐัะธั ัะตัะตะท Telegram** ะฟะตัะตะด ะฟัะฑะปะธะบะฐัะธะตะน
- **Docker** ะดะปั ะธะทะพะปััะธะธ ะธ ัะดะพะฑะฝะพะณะพ ะดะตะฟะปะพั

---

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Docker ะธ Docker Compose
- Telegram ะฐะบะบะฐัะฝั ะดะปั ัะฑะพัะฐ ะฝะพะฒะพััะตะน
- Google Gemini API key
- ะะดะธะฝ ะธะปะธ ะฝะตัะบะพะปัะบะพ Telegram ะบะฐะฝะฐะปะพะฒ ะดะปั ะฟัะฑะปะธะบะฐัะธะธ (ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฟัะพัะธะปั)

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

```bash
# ะะพะฟะธััะตะผ ะฟัะธะผะตั
cp .env.example .env

# ะะตะดะฐะบัะธััะตะผ .env
nano .env
```

ะะฐะฟะพะปะฝะธ ะฟะตัะตะผะตะฝะฝัะต:

```env
TELEGRAM_API_ID=your_api_id           # https://my.telegram.org/apps
TELEGRAM_API_HASH=your_api_hash
TELEGRAM_PHONE=+79XXXXXXXXX           # ะะพะผะตั Telegram ะฐะบะบะฐัะฝัะฐ ะดะปั ัะฑะพัะฐ ะฝะพะฒะพััะตะน

GEMINI_API_KEY=your_gemini_api_key    # https://makersuite.google.com/app/apikey

MY_PERSONAL_ACCOUNT=@your_username    # ะัะดะฐ ะพัะฟัะฐะฒะปััั ัะพะพะฑัะตะฝะธั ะผะพะดะตัะฐัะธะธ
MY_CHANNEL=@your_channel              # ะะฐะฝะฐะป ะดะปั ะฟัะฑะปะธะบะฐัะธะธ (ะพัะฝะพะฒะฝะพะน)

# ะะปั ะฟัะพัะธะปั marketplace (ะพะฟัะธะพะฝะฐะปัะฝะพ):
OZON_CHANNEL=@your_ozon_channel
WB_CHANNEL=@your_wb_channel
```

**ะัะธะผะตัะฐะฝะธะต:** ะะพะฝะบัะตัะฝัะต ะบะฐะฝะฐะปั ะฝะฐัััะฐะธะฒะฐัััั ะฒ ะฟัะพัะธะปัั (`config/profiles/*.yaml`), ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะธัะฟะพะปัะทััััั ะบะฐะบ ะทะฐะฟะฐัะฝะพะน ะฒะฐัะธะฐะฝั.

### 2. ะะฐัััะพะนะบะฐ ะฟัะพัะธะปะตะน ะบะพะฝัะธะณััะฐัะธะธ

ะะพะฝัะธะณััะฐัะธั ัะฐะทะดะตะปะตะฝะฐ ะฝะฐ ะฑะฐะทะพะฒัั (`config/base.yaml`) ะธ ะฟัะพัะธะปะธ (`config/profiles/*.yaml`).

#### ะะพัััะฟะฝัะต ะฟัะพัะธะปะธ:

1. **marketplace** - ะะพะฒะพััะธ ะผะฐัะบะตัะฟะปะตะนัะพะฒ (Ozon, Wildberries)
2. **ai** - ะะพะฒะพััะธ ะธัะบััััะฒะตะฝะฝะพะณะพ ะธะฝัะตะปะปะตะบัะฐ
3. **generic** - ะฃะฝะธะฒะตััะฐะปัะฝัะน ัะฐะฑะปะพะฝ ะดะปั ะปัะฑะพะน ะบะฐัะตะณะพัะธะธ

#### ะกัััะบัััะฐ ะบะพะฝัะธะณััะฐัะธะธ:

- `config/base.yaml` โ ะพะฑัะธะต ะฟะฐัะฐะผะตััั (ะฟััะธ, ะะ, ะฟัะฑะปะธะบะฐัะธั, ัะฐัะฟะธัะฐะฝะธะต)
- `config/profiles/marketplace.yaml` โ ะฟัะพัะธะปั ะดะปั ะผะฐัะบะตัะฟะปะตะนัะพะฒ
- `config/profiles/ai.yaml` โ ะฟัะพัะธะปั ะดะปั AI ะฝะพะฒะพััะตะน
- `config/profiles/generic.yaml` โ ัะฝะธะฒะตััะฐะปัะฝัะน ัะฐะฑะปะพะฝ

#### ะัะธะผะตั ะฟัะพัะธะปั ั ะบะฐัะตะณะพัะธัะผะธ (generic.yaml):

```yaml
profile: generic

publication:
  channel: "@your_news_channel"
  header_template: "๐ฐ ะะปะฐะฒะฝัะต ะฝะพะฒะพััะธ ะทะฐ {date}"
  footer_template: "ะะพะดะฟะธัะธัั ะฝะฐ ะบะฐะฝะฐะป: https://t.me/your_news_channel"

# ะฃะฝะธะฒะตััะฐะปัะฝะฐั ัะธััะตะผะฐ ะบะฐัะตะณะพัะธะน (ะฒะผะตััะพ marketplaces)
categories:
  - name: ai
    display_name: Artificial Intelligence
    enabled: true
    top_n: 10
    target_channel: "@your_news_channel"
    keywords:
      - ai
      - artificial intelligence
      - ะฝะตะนัะพัะตัั
    exclude_keywords:
      - ัะตะบะปะฐะผะฐ

  - name: crypto
    display_name: Cryptocurrency
    enabled: true
    top_n: 10
    target_channel: "@your_news_channel"
    keywords:
      - crypto
      - bitcoin
      - ethereum

# ะะฐัััะพะนะบะฐ ะบะพะผะฑะธะฝะธัะพะฒะฐะฝะฝะพะณะพ ะดะฐะนะดะถะตััะฐ
channels:
  all_digest:
    enabled: true
    target_channel: "@your_news_channel"
    category_counts:
      ai: 5
      crypto: 3
      tech: 2
```

**ะัะธะผะตัะฐะฝะธะต:** ะกัะฐััะต ะฟัะพัะธะปะธ ะธัะฟะพะปัะทััั `marketplaces:` ะฒะผะตััะพ `categories:` - ะพะฑะฐ ะฒะฐัะธะฐะฝัะฐ ะฟะพะดะดะตัะถะธะฒะฐัััั ะดะปั ะพะฑัะฐัะฝะพะน ัะพะฒะผะตััะธะผะพััะธ.

### 3. ะะตัะฒัะน ะทะฐะฟััะบ (ะฝะฐัััะพะนะบะฐ Telegram)

```bash
# ะกะพะฑะธัะฐะตะผ ะพะฑัะฐะท (ะทะฐะนะผัั 10-15 ะผะธะฝัั ะธะท-ะทะฐ torch)
docker-compose build

# ะะตัะฒัะน ะทะฐะฟััะบ ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ ะฒ Telegram (ั ะฒัะฑัะฐะฝะฝัะผ ะฟัะพัะธะปะตะผ)
# ะะปั ะผะฐัะบะตัะฟะปะตะนัะพะฒ:
docker-compose run marketplace-listener python main.py listener --profile marketplace

# ะะปะธ ะดะปั AI:
docker-compose run marketplace-listener python main.py listener --profile ai
```

ะะฒะตะดะธ ะบะพะด ะธะท Telegram ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ. ะะพัะปะต ััะฟะตัะฝะพะน ะฐะฒัะพัะธะทะฐัะธะธ ะฝะฐะถะผะธ `Ctrl+C`.

### 4. ะะฐะฟััะบ ะฒ ัะพะฝะต

```bash
# ะะฐะฟััะบะฐะตะผ listener ะฒ ัะพะฝะต
docker-compose up -d marketplace-listener

# ะัะพะฒะตััะตะผ ะปะพะณะธ
docker-compose logs -f marketplace-listener
```

### 5. ะะฑัะฐะฑะพัะบะฐ ะฝะพะฒะพััะตะน ั ะฒัะฑะพัะพะผ ะฟัะพัะธะปั

ะะพั ะฟะพะดะดะตัะถะธะฒะฐะตั ะทะฐะฟััะบ ั ัะฐะทะฝัะผะธ ะฟัะพัะธะปัะผะธ ัะตัะตะท ะฟะฐัะฐะผะตัั `--profile`:

```bash
# ะัะพัะธะปั marketplace (ะผะฐัะบะตัะฟะปะตะนัั)
docker-compose run --rm marketplace-processor python main.py processor --profile marketplace

# ะัะพัะธะปั ai (ะฝะพะฒะพััะธ AI)
docker-compose run --rm marketplace-processor python main.py processor --profile ai

# ะัะพัะธะปั generic (ัะฝะธะฒะตััะฐะปัะฝัะน ัะฐะฑะปะพะฝ)
docker-compose run --rm marketplace-processor python main.py processor --profile generic

# ะัะปะธ ะฟัะพัะธะปั ะฝะต ัะบะฐะทะฐะฝ, ะธัะฟะพะปัะทัะตััั ะทะฝะฐัะตะฝะธะต ะธะท config/base.yaml
docker-compose run --rm marketplace-processor python main.py processor
```

#### ะะฐัััะพะนะบะฐ cron ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพะฑัะฐะฑะพัะบะธ:

```bash
# ะะปั ะผะฐัะบะตัะฟะปะตะนัะพะฒ (ะบะฐะถะดัะน ะดะตะฝั ะฒ 09:00)
0 9 * * * cd /root/tg-news-bot && docker-compose run --rm marketplace-processor python main.py processor --profile marketplace >> logs/cron.log 2>&1

# ะะปั AI ะฝะพะฒะพััะตะน (ะบะฐะถะดัะน ะดะตะฝั ะฒ 06:00)
0 6 * * * cd /root/tg-news-bot && docker-compose run --rm marketplace-processor python main.py processor --profile ai >> logs/cron.log 2>&1
```

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
tg-news-bot/
โโโ config/
โ   โโโ base.yaml            # ะะฑัะธะต ะฝะฐัััะพะนะบะธ (ะฟััะธ, ะฟัะฑะปะธะบะฐัะธั, retry)
โ   โโโ profiles/
โ   โ   โโโ marketplace.yaml # ะัะพัะธะปั ะผะฐัะบะตัะฟะปะตะนัะพะฒ (Ozon, Wildberries)
โ   โ   โโโ ai.yaml          # ะัะพัะธะปั AI-ะฝะพะฒะพััะตะน
โ   โ   โโโ generic.yaml     # ะฃะฝะธะฒะตััะฐะปัะฝัะน ัะฐะฑะปะพะฝ
โ   โโโ prompts/             # ะัะพะผะฟัั ะดะปั Gemini AI
โโโ .env                     # ะกะตะบัะตัะฝัะต ะบะปััะธ (ะฝะต ะบะพะผะผะธัะธััั)
โโโ docker-compose.yml       # Docker ะบะพะฝัะธะณััะฐัะธั
โโโ Dockerfile               # Docker ะพะฑัะฐะท
โโโ requirements.txt         # Python ะทะฐะฒะธัะธะผะพััะธ
โโโ main.py                  # ะขะพัะบะฐ ะฒัะพะดะฐ
โ
โโโ database/
โ   โโโ db.py               # ะะฐะฑะพัะฐ ั SQLite
โ
โโโ services/
โ   โโโ telegram_listener.py        # ะกะปััะฐัะตะปั ะบะฐะฝะฐะปะพะฒ
โ   โโโ news_processor.py           # ะฃะฝะธะฒะตััะฐะปัะฝัะน ะพะฑัะฐะฑะพััะธะบ ะฝะพะฒะพััะตะน
โ   โโโ gemini_client.py            # ะะปะธะตะฝั Gemini AI
โ   โโโ status_reporter.py          # ะงะฐัะพะฒัะต ััะฐััั-ัะตะฟะพััั
โ   โโโ embeddings.py               # ะัะพะฒะตัะบะฐ ะดัะฑะปะธะบะฐัะพะฒ
โ
โโโ models/
โ   โโโ config_schemas.py           # ะกัะตะผั ะบะพะฝัะธะณััะฐัะธะธ
โ   โโโ category.py                 # ะะพะดะตะปะธ ะบะฐัะตะณะพัะธะน
โ
โโโ utils/
โ   โโโ config.py           # ะะฐะณััะทะบะฐ ะบะพะฝัะธะณััะฐัะธะธ ั ะฟัะพัะธะปัะผะธ
โ   โโโ logger.py           # ะะพะณะธัะพะฒะฐะฝะธะต
โ
โโโ data/                   # ะะฐะทะฐ ะดะฐะฝะฝัั (ัะพะทะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
โโโ logs/                   # ะะพะณะธ (ัะพะทะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
```

---

## ๐ง ะะตะถะธะผั ัะฐะฑะพัั

### Listener (ะกะปััะฐัะตะปั)

ะะฐะฑะพัะฐะตั 24/7, ัะพะฑะธัะฐะตั ัะพะพะฑัะตะฝะธั ะธะท ะฒัะตั ะฟะพะดะฟะธัะฐะฝะฝัั ะบะฐะฝะฐะปะพะฒ:

```bash
docker-compose up -d marketplace-listener
```

### Processor (ะะฑัะฐะฑะพััะธะบ)

ะะฐะฟััะบะฐะตััั ะฟะพ ัะฐัะฟะธัะฐะฝะธั (ะพะฑััะฝะพ ัะฐะท ะฒ ะดะตะฝั) ะธะปะธ ะฒัััะฝัั:

```bash
# ะก ัะบะฐะทะฐะฝะธะตะผ ะฟัะพัะธะปั
docker-compose run --rm marketplace-processor python main.py processor --profile marketplace

# ะะตะท ะฟัะพัะธะปั (ะธัะฟะพะปัะทัะตััั ะธะท config/base.yaml)
docker-compose run --rm marketplace-processor python main.py processor
```

**ะงัะพ ะดะตะปะฐะตั Processor:**

1. ะะฐะณััะถะฐะตั ัะพะพะฑัะตะฝะธั ะทะฐ ะฟะพัะปะตะดะฝะธะต 24 ัะฐัะฐ ะธะท ะะ
2. ะคะธะปััััะตั ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ ะบะฐัะตะณะพัะธะน (ะธะท ะฟัะพัะธะปั)
3. ะัะพะฒะตััะตั ะฝะฐ ะดัะฑะปะธะบะฐัั ัะตัะตะท embeddings
4. ะัะฑะธัะฐะตั ัะพะฟ-N ัะตัะตะท Gemini AI ะดะปั ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ
5. ะัะฟัะฐะฒะปัะตั ะฝะฐ ะผะพะดะตัะฐัะธั ะฒ Telegram (ะพะฟัะธะพะฝะฐะปัะฝะพ)
6. ะัะฑะปะธะบัะตั ะพะดะพะฑัะตะฝะฝัะต ะฝะพะฒะพััะธ ะฒ ะฝะฐัััะพะตะฝะฝัะต ะบะฐะฝะฐะปั

---

## ๐ ะะฐะบ ัะฐะฑะพัะฐะตั ะพัะฑะพั ะฝะพะฒะพััะตะน

ะะพั ะธัะฟะพะปัะทัะตั AI (Gemini) ะดะปั ะฐะฝะฐะปะธะทะฐ ะธ ะพัะฑะพัะฐ ะฝะพะฒะพััะตะน ะฟะพ ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ. ะัะธัะตัะธะธ ะพัะฑะพัะฐ ะฝะฐัััะฐะธะฒะฐัััั ัะตัะตะท ะฟัะพะผะฟัั ะฒ `config/prompts/`.

### ะัะธะผะตั ะบัะธัะตัะธะตะฒ ะดะปั ะผะฐัะบะตัะฟะปะตะนัะพะฒ (ะฟัะพัะธะปั marketplace)

**ะะซะกะะะะ ะะะะะะะขะะข (9-10)**
- ะะทะผะตะฝะตะฝะธั ะฒ ัะฐะฑะพัะต ะผะฐัะบะตัะฟะปะตะนัะฐ (ะบะพะผะธััะธะธ, ะฟัะฐะฒะธะปะฐ)
- ะัะธัะธะฐะปัะฝัะต ะพะฑะฝะพะฒะปะตะฝะธั
- ะะฐะถะฝัะต ะฝะพะฒะพััะธ ะดะปั ะฟัะพะดะฐะฒัะพะฒ

**ะกะะะะะะ ะะะะะะะขะะข (7-8)**
- ะะตะนัั ััะฟะตัะฝัั ะฟัะพะดะฐะฒัะพะฒ
- ะะพะฒัะต ะธะฝััััะผะตะฝัั ะธ ัะตัะฒะธัั
- ะขัะตะฝะดั ะธ ะฐะฝะฐะปะธัะธะบะฐ

**ะะะะะะ ะะะะะะะขะะข (5-6)**
- ะะฑัะธะต ัะพะฒะตัั
- ะกัะฐัะธััะธะบะฐ ััะฝะบะฐ

**ะะกะะะฎะงะะะขะกะฏ:**
- ะะตะบะปะฐะผะฐ ะบัััะพะฒ ะธ ะบะพะฝััะปััะฐัะธะน
- ะะตะผั ะฑะตะท ะฟะพะปัะทั
- ะะตัะตะปะตะฒะฐะฝัะฝัะต ะฝะพะฒะพััะธ

### ะัะธะผะตั ะบัะธัะตัะธะตะฒ ะดะปั AI ะฝะพะฒะพััะตะน (ะฟัะพัะธะปั ai)

**ะะซะกะะะะ ะะะะะะะขะะข**
- ะะตะปะธะทั ะฝะพะฒัั AI ะผะพะดะตะปะตะน
- ะัะพััะฒั ะฒ ะธััะปะตะดะพะฒะฐะฝะธัั
- ะะฐะถะฝัะต ะพะฑะฝะพะฒะปะตะฝะธั ะฟะพะฟัะปััะฝัั ะธะฝััััะผะตะฝัะพะฒ

**ะกะะะะะะ ะะะะะะะขะะข**
- ะัะฐะบัะธัะตัะบะธะต ะบะตะนัั ะฟัะธะผะตะฝะตะฝะธั
- ะะพะฒัะต ะฟัะพะดัะบัั ะธ ัะตัะฒะธัั
- ะะฝะฐะปะธัะธะบะฐ ะธ ััะตะฝะดั

**ะะกะะะฎะงะะะขะกะฏ:**
- ะะตะบะปะฐะผะฐ ะบัััะพะฒ
- ะะตะผั ะธ ัะฐะทะฒะปะตะบะฐัะตะปัะฝัะน ะบะพะฝัะตะฝั
- ะะธะทะบะพะบะฐัะตััะฒะตะฝะฝัะต ะฝะพะฒะพััะธ

### ะะฐัััะพะนะบะฐ ัะฒะพะธั ะบัะธัะตัะธะตะฒ

ะั ะผะพะถะตัะต ัะพะทะดะฐัั ัะฒะพะน ะฟัะพัะธะปั ะฒ `config/profiles/` ะธ ะฝะฐัััะพะธัั:
- ะะฐัะตะณะพัะธะธ ะธ ะบะปััะตะฒัะต ัะปะพะฒะฐ
- ะัะพะผะฟัั ะดะปั AI ะฒ `config/prompts/`
- ะะพะปะธัะตััะฒะพ ะฝะพะฒะพััะตะน ะดะปั ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ

---

## ๐ Workflow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะพะดะฟะธัะฐะฝะฝัะต Telegram ะบะฐะฝะฐะปั           โ
โ   (ะบะพะปะธัะตััะฒะพ ะทะฐะฒะธัะธั ะพั ะฟัะพัะธะปั)       โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Listener (24/7 ะฒ Docker)               โ
โ   ะกะพะฑะธัะฐะตั ะฒัะต ัะพะพะฑัะตะฝะธั ะธะท ะบะฐะฝะฐะปะพะฒ     โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Database (SQLite)                      โ
โ   ะฅัะฐะฝะธั ััััะต ัะพะพะฑัะตะฝะธั                โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Processor (ะฟะพ ัะฐัะฟะธัะฐะฝะธั/ะฒัััะฝัั)      โ
โ                                          โ
โ   1. ะคะธะปััั ะฟะพ keywords ะบะฐัะตะณะพัะธะน       โ
โ   2. ะัะพะฒะตัะบะฐ ะดัะฑะปะธะบะฐัะพะฒ (embeddings)   โ
โ   3. Gemini ะพัะฑะธัะฐะตั ัะพะฟ-N ะฝะพะฒะพััะตะน     โ
โ   4. ะะพะดะตัะฐัะธั ัะตัะตะท Telegram           โ
โ   5. ะัะฑะปะธะบะฐัะธั ะฒ ะบะฐะฝะฐะปั                โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะัะฑะปะธะบะฐัะธั ะฒ ะฝะฐัััะพะตะฝะฝัะต ะบะฐะฝะฐะปั        โ
โ   (ะพะดะธะฝ ะธะปะธ ะฝะตัะบะพะปัะบะพ, ะทะฐะฒะธัะธั ะพั        โ
โ    ะบะพะฝัะธะณััะฐัะธะธ ะบะฐัะตะณะพัะธะน)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Troubleshooting

### ะัะพะฑะปะตะผะฐ: Docker ัะฑะพัะบะฐ ะดะพะปะณะพ ะธะดัั

**ะะตัะตะฝะธะต:** ะญัะพ ะฝะพัะผะฐะปัะฝะพ! Torch ะทะฐะฝะธะผะฐะตั 2GB, ัะฑะพัะบะฐ ะผะพะถะตั ะทะฐะฝััั 10-15 ะผะธะฝัั.

### ะัะพะฑะปะตะผะฐ: Session already running

**ะะตัะตะฝะธะต:**

```bash
# ะััะฐะฝะพะฒะธ listener
docker-compose stop marketplace-listener

# ะฃะดะฐะปะธ session ัะฐะนะปั
rm data/*.session*

# ะะตัะตะทะฐะฟัััะธ
docker-compose up -d marketplace-listener
```

### ะัะพะฑะปะตะผะฐ: Database locked

**ะะตัะตะฝะธะต:**

```bash
# ะััะฐะฝะพะฒะธ ะฒัะต ะบะพะฝัะตะนะฝะตัั
docker-compose down

# ะะพะดะพะถะดะธ 5 ัะตะบัะฝะด
sleep 5

# ะะฐะฟัััะธ ะทะฐะฝะพะฒะพ
docker-compose up -d marketplace-listener
```

### ะัะพะฑะปะตะผะฐ: Gemini API ะพัะธะฑะบะฐ

**ะะตัะตะฝะธะต:**

1. ะัะพะฒะตัั API key ะฒ `.env`
2. ะัะพะฒะตัั ะบะฒะพัั ะฝะฐ <https://makersuite.google.com/>
3. ะฃะฑะตะดะธัั ััะพ ะผะพะดะตะปั `gemini-2.0-flash-exp` ะดะพัััะฟะฝะฐ

---

## ๐ ะะฐัััะพะนะบะฐ cron ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพะฑัะฐะฑะพัะบะธ

```bash
# ะัะบัะพะน crontab
crontab -e

# ะัะธะผะตัั ะดะปั ัะฐะทะฝัั ะฟัะพัะธะปะตะน:

# ะะฐัะบะตัะฟะปะตะนัั (ะบะฐะถะดัะน ะดะตะฝั ะฒ 09:00)
0 9 * * * cd /root/tg-news-bot && docker-compose run --rm marketplace-processor python main.py processor --profile marketplace >> /root/tg-news-bot/logs/cron.log 2>&1

# AI ะฝะพะฒะพััะธ (ะบะฐะถะดัะน ะดะตะฝั ะฒ 06:00)
0 6 * * * cd /root/tg-news-bot && docker-compose run --rm marketplace-processor python main.py processor --profile ai >> /root/tg-news-bot/logs/cron.log 2>&1

# ะฃะฝะธะฒะตััะฐะปัะฝัะน ะฟัะพัะธะปั (ะบะฐะถะดัะน ะดะตะฝั ะฒ 10:00)
0 10 * * * cd /root/tg-news-bot && docker-compose run --rm marketplace-processor python main.py processor --profile generic >> /root/tg-news-bot/logs/cron.log 2>&1
```

---

## ๐ ะะฐะถะฝะพ ะฟัะพ ะฑะตะทะพะฟะฐัะฝะพััั

1. **ะัะฟะพะปัะทัะน ะพัะดะตะปัะฝัะน Telegram ะฐะบะบะฐัะฝั** ะดะปั ะบะฐะถะดะพะณะพ ะฟัะพัะธะปั (ะตัะปะธ ะทะฐะฟััะบะฐะตัั ะฝะตัะบะพะปัะบะพ)
2. **ะะต ะบะพะผะผะธัั .env ัะฐะนะป** ะฒ Git (ัะถะต ะฒ .gitignore)
3. **ะะต ะดะตะปะธัั session ัะฐะนะปะฐะผะธ** - ะพะฝะธ ะดะฐัั ะฟะพะปะฝัะน ะดะพัััะฟ ะบ ะฐะบะบะฐัะฝัั
4. **Gemini API key** ะดะตัะถะธ ะฒ ัะตะบัะตัะต
5. **Session ัะฐะนะปั ะธะทะพะปะธัะพะฒะฐะฝั ะฟะพ ะฟัะพัะธะปัะผ** - ะบะฐะถะดัะน ะฟัะพัะธะปั ะธัะฟะพะปัะทัะตั ัะฒะพั ัะตััะธั

---

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ

```bash
# ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose ps

# ะะพะณะธ listener
docker-compose logs -f marketplace-listener

# ะะพะณะธ ะฟะพัะปะตะดะฝะตะณะพ processor
docker-compose logs marketplace-processor

# ะัะพะฒะตัะบะฐ ะะ (ะฟััะธ ะทะฐะฒะธััั ะพั ะฟัะพัะธะปั)
sqlite3 data/marketplace.db "SELECT COUNT(*) FROM raw_messages"  # marketplace ะฟัะพัะธะปั
sqlite3 data/ai.db "SELECT COUNT(*) FROM raw_messages"           # ai ะฟัะพัะธะปั
sqlite3 data/generic.db "SELECT COUNT(*) FROM raw_messages"      # generic ะฟัะพัะธะปั
```

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะัะพะฒะตัะธัั ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ (ะดะพะปะถะตะฝ ะฑััั healthy)
docker-compose ps

# ะะตัะตะทะฐะฟััะบ listener
docker-compose restart marketplace-listener

# ะััะฐะฝะพะฒะบะฐ ะฒัะตะณะพ
docker-compose down

# ะัะธััะบะฐ ะปะพะณะพะฒ ะดะปั ะบะพะฝะบัะตัะฝะพะณะพ ะฟัะพัะธะปั
> logs/marketplace/bot.log
> logs/ai/bot.log

# ะะตะฑะธะปะด ะพะฑัะฐะทะฐ ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธะน
docker-compose build --no-cache
```


### ะะพะณะธ ะฟะพ ะฟัะพัะธะปัะผ

ะะฐะถะดัะน ะฟัะพัะธะปั ัะพะทะดะฐะตั ัะฒะพะธ ะปะพะณะธ ะฒ ะพัะดะตะปัะฝะพะน ะดะธัะตะบัะพัะธะธ:
- `logs/marketplace/` - ะปะพะณะธ ะฟัะพัะธะปั marketplace
- `logs/ai/` - ะปะพะณะธ ะฟัะพัะธะปั ai
- `logs/generic/` - ะปะพะณะธ ะฟัะพัะธะปั generic

ะคะฐะนะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพัะธัััััั Python-ัะตะฝะดะปะตัะพะผ (5ร10 MB).

ะะพะฟะพะปะฝะธัะตะปัะฝะพ ะผะพะถะฝะพ ะทะฐะฟัััะธัั `logrotate` ะฒะฝัััะธ ะบะพะฝัะตะนะฝะตัะฐ:

```bash
docker exec marketplace-listener logrotate -f /app/docker/logrotate.conf
```

### ะัะบะฐะฟั ะฑะฐะทั

```bash
# ะัะบะฐะฟ ะดะปั ะบะพะฝะบัะตัะฝะพะณะพ ะฟัะพัะธะปั
./scripts/backup_db.sh data/marketplace.db
./scripts/backup_db.sh data/ai.db

# ะะพัััะฐะฝะพะฒะปะตะฝะธะต
./scripts/restore_db.sh <ะฟััั-ะบ-ะฑัะบะฐะฟั>
```

ะะพะดัะพะฑะฝัะน ะฟะปะฐะฝ: `docs/backup_runbook.md`

---

## ๐ ะะฐะทัะฐะฑะพัะบะฐ

- ะฃััะฐะฝะพะฒะธ dev-ะทะฐะฒะธัะธะผะพััะธ: `pip install -r requirements-dev.txt`
- ะะบัะธะฒะธััะน ััะบะธ: `pre-commit install`
- ะะฐะฟััะบะฐะน ะฟัะพะฒะตัะบั ะฟะตัะตะด ะฟััะตะผ: `pre-commit run --all-files`
- ะะฒัะพะธัะฟัะฐะฒะปะตะฝะธะต: `make lint-fix`

---

## ๐จ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะะพะฒะพััะธ ะผะฐัะบะตัะฟะปะตะนัะพะฒ

**ะัะพัะธะปั:** `marketplace`
- ะะฐัะตะณะพัะธะธ: Ozon, Wildberries
- ะะฐะฝะฐะปั: 200+ ะฟัะพ ะผะฐัะบะตัะฟะปะตะนัั
- ะัะฑะปะธะบะฐัะธั: 2 ะบะฐะฝะฐะปะฐ (ะพัะดะตะปัะฝะพ ะดะปั ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ)

### ะัะธะผะตั 2: AI ะฝะพะฒะพััะธ

**ะัะพัะธะปั:** `ai`
- ะะฐัะตะณะพัะธะธ: AI, ะผะฐัะธะฝะฝะพะต ะพะฑััะตะฝะธะต
- ะะฐะฝะฐะปั: ~20 ะฟัะพ ะธัะบััััะฒะตะฝะฝัะน ะธะฝัะตะปะปะตะบั
- ะัะฑะปะธะบะฐัะธั: 1 ะพะฑัะธะน ะบะฐะฝะฐะป

### ะัะธะผะตั 3: ะฃะฝะธะฒะตััะฐะปัะฝัะน ะดะฐะนะดะถะตัั

**ะัะพัะธะปั:** `generic`
- ะะฐัะตะณะพัะธะธ: AI, ะบัะธะฟัะพ, ัะตัะฝะพะปะพะณะธะธ (ะฝะฐัััะฐะธะฒะฐะตััั)
- ะะฐะฝะฐะปั: ะปัะฑัะต ะฟะพ ะฒะฐัะตะผั ะฒัะฑะพัั
- ะัะฑะปะธะบะฐัะธั: 1 ะธะปะธ ะฝะตัะบะพะปัะบะพ ะบะฐะฝะฐะปะพะฒ

ะกะพะทะดะฐะนัะต ัะฒะพะน ะฟัะพัะธะปั ะฒ `config/profiles/your_profile.yaml` ะดะปั ะปัะฑะพะน ัะตะผะฐัะธะบะธ!

---

## ๐จ ะกะพะทะดะฐะฝะธะต ัะพะฑััะฒะตะฝะฝะพะณะพ ะฟัะพัะธะปั

ะฅะพัะธัะต ัะพะฑะธัะฐัั ะฝะพะฒะพััะธ ะฟะพ ัะฒะพะตะน ัะตะผะฐัะธะบะต? ะะพั ะบะฐะบ ััะพ ัะดะตะปะฐัั:

### ะจะฐะณ 1: ะกะพะทะดะฐะนัะต ัะฐะนะป ะฟัะพัะธะปั

```bash
cp config/profiles/generic.yaml config/profiles/myprofile.yaml
```

### ะจะฐะณ 2: ะะฐัััะพะนัะต ะบะฐัะตะณะพัะธะธ

ะััะตะดะฐะบัะธััะนัะต `config/profiles/myprofile.yaml`:

```yaml
profile: myprofile

publication:
  channel: "@your_channel"
  header_template: "๐ฐ ะะพะฒะพััะธ ะทะฐ {date}"

# ะะฟัะตะดะตะปะธัะต ัะฒะพะธ ะบะฐัะตะณะพัะธะธ
categories:
  - name: gaming
    display_name: Gaming
    enabled: true
    top_n: 10
    target_channel: "@your_channel"
    keywords:
      - ะธะณัั
      - gaming
      - playstation
      - xbox
    exclude_keywords:
      - ัะตะบะปะฐะผะฐ

  - name: movies
    display_name: Movies
    enabled: true
    top_n: 5
    keywords:
      - ะบะธะฝะพ
      - ัะธะปัะผ
      - movies
```

### ะจะฐะณ 3: ะะฐะฟัััะธัะต ั ะฝะพะฒัะผ ะฟัะพัะธะปะตะผ

```bash
# Listener
docker-compose run marketplace-listener python main.py listener --profile myprofile

# Processor
docker-compose run --rm marketplace-processor python main.py processor --profile myprofile
```

### ะจะฐะณ 4: ะะฐัััะพะนัะต ะฟัะพะผะฟัั (ะพะฟัะธะพะฝะฐะปัะฝะพ)

ะกะพะทะดะฐะนัะต ะบะฐััะพะผะฝัะน ะฟัะพะผะฟั ะฒ `config/prompts/myprofile_select.md` ะธ ัะบะฐะถะธัะต ะตะณะพ ะฒ ะบะพะฝัะธะณะต.

---

## ๐ค ะะพะดะดะตัะถะบะฐ

ะัะปะธ ะฒะพะทะฝะธะบะปะธ ะฒะพะฟัะพัั - ะฟัะพะฒะตัั:

1. ะะพะณะธ: `docker-compose logs`
2. Config: `config/base.yaml` ะธ ะฟัะพัะธะปั ะฟัะฐะฒะธะปัะฝะพ ะทะฐะฟะพะปะฝะตะฝั?
3. .env: ะฒัะต ะบะปััะธ ะฝะฐ ะผะตััะต?
4. Telegram: ะฐะบะบะฐัะฝั ะฐะฒัะพัะธะทะพะฒะฐะฝ ะดะปั ัะตะบััะตะณะพ ะฟัะพัะธะปั?
5. ะัะพัะธะปั: ะฟัะฐะฒะธะปัะฝัะน ะฟัะพัะธะปั ัะบะฐะทะฐะฝ ะฟัะธ ะทะฐะฟััะบะต (`--profile`)?

---

## ๐ ะะธัะตะฝะทะธั

ะัะพะตะบั ะดะปั ะปะธัะฝะพะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั. ะะต ะทะฐะฑัะดั ัะพะฑะปัะดะฐัั Terms of Service Telegram ะธ Google.

---

**ะฃะดะฐัะธ ะฒ ะทะฐะฟััะบะต! ๐**
