# üó∫Ô∏è –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê: NEWS-TO-REELS GENERATOR

**–í–µ—Ä—Å–∏—è:** 1.0.0
**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:** 2025-10-20
**–û–∂–∏–¥–∞–µ–º–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** 2025-10-22 (11-17 —á–∞—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
**–°—Ç–∞—Ç—É—Å:** üî® In Progress

---

## üìå –ö–û–ù–¢–ï–ö–°–¢ –ò –¶–ï–õ–ò

| –ê—Å–ø–µ–∫—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| **–ü—Ä–æ–µ–∫—Ç** | News-to-Reels Generator ‚Äî –º–æ–¥—É–ª—å –¥–ª—è TG News Bot |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ Instagram Reels –∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ Perplexity API |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (`reels/`), –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¢–ù–ë |
| **–¶–µ–ª—å** | Production-ready –º–æ–¥—É–ª—å —Å coverage > 70%, –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, –≥–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é |

---

## üéØ –û–°–ù–û–í–ù–´–ï –ó–ê–î–ê–ß–ò

1. **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫, –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. **Perplexity API –∫–ª–∏–µ–Ω—Ç** ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API, retry –ª–æ–≥–∏–∫–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è
3. **–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä Reels** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î –¢–ù–ë, Telegram –º–æ–¥–µ—Ä–∞—Ü–∏—è
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main.py** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ `reels`, –∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ processor
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî unit-—Ç–µ—Å—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, coverage
6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî README, –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, API reference

---

## ‚öñÔ∏è –ü–û–î–•–û–î –ö –†–ê–ó–†–ê–ë–û–¢–ö–ï

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å —Å –¢–ù–ë, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
- **–ú–∞–ª—ã–µ –ø–∞—Ä—Ç–∏–∏**: –ö–æ–º–º–∏—Ç—ã –Ω–µ –±–æ–ª–µ–µ 300 —Å—Ç—Ä–æ–∫, diff-limit –∫–æ–Ω—Ç—Ä–æ–ª—å
- **Test-Driven**: –¢–µ—Å—Ç—ã –ø–∏—à—É—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∫–æ–¥–æ–º
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¢–ù–ë

### –ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–±–æ—Ç—ã

1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞:
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ todo list (TodoWrite)
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
   - –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
   - –ö–æ–º–º–∏—Ç —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PROGRESS.md

2. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —ç—Ç–∞–ø–∞:
   - ‚úÖ –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
   - ‚úÖ –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
   - ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
   - ‚úÖ Code review –ø—Ä–æ–π–¥–µ–Ω

---

## üî¢ –≠–¢–ê–ü–´ –†–ê–ó–†–ê–ë–û–¢–ö–ò

### –û–±–∑–æ—Ä

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ | –í—Ä–µ–º—è | –ö–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏ | –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ |
|-----|----------|-------|-----------------|---------------------|
| **1** | –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | 2-3 —á–∞—Å–∞ | –°—Ç—Ä—É–∫—Ç—É—Ä–∞, –º–æ–¥–µ–ª–∏, –∫–æ–Ω—Ñ–∏–≥ | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞, –º–æ–¥–µ–ª–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è |
| **2** | Perplexity Client | 2-3 —á–∞—Å–∞ | API –∫–ª–∏–µ–Ω—Ç, retry, –≤–∞–ª–∏–¥–∞—Ü–∏—è | –£—Å–ø–µ—à–Ω—ã–µ –≤—ã–∑–æ–≤—ã API, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç |
| **3** | Reels Processor | 3-4 —á–∞—Å–∞ | –û–±—Ä–∞–±–æ—Ç–∫–∞, –ë–î, Telegram | End-to-end –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **4** | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è main.py | 1-2 —á–∞—Å–∞ | –ù–æ–≤—ã–π —Ä–µ–∂–∏–º, –∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫ | `python main.py reels` —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **5** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 2-3 —á–∞—Å–∞ | Unit-—Ç–µ—Å—Ç—ã, integration | Coverage > 70% |
| **6** | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 1-2 —á–∞—Å–∞ | README, –ø—Ä–∏–º–µ—Ä—ã, API docs | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è |

---

## üìã –≠–¢–ê–ü 1: –ü–û–î–ì–û–¢–û–í–ö–ê –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–´

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

### –ó–∞–¥–∞—á–∏

#### 1.1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ (30 –º–∏–Ω)

```bash
tg-news-bot/reels/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ news.py
‚îÇ   ‚îî‚îÄ‚îÄ reels.py
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ perplexity_client.py
‚îÇ   ‚îî‚îÄ‚îÄ reels_processor.py
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ reels_config.py
‚îú‚îÄ‚îÄ prompts/
‚îÇ   ‚îú‚îÄ‚îÄ enrich_news.md
‚îÇ   ‚îî‚îÄ‚îÄ generate_reels.md
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_perplexity_client.py
    ‚îî‚îÄ‚îÄ test_reels_processor.py
```

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `reels/__init__.py`
- `reels/main.py` (–∑–∞–≥–ª—É—à–∫–∞)
- –í—Å–µ `__init__.py` –≤ –ø–æ–¥–ø–∞–ø–∫–∞—Ö

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í—Å–µ –ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç PROJECT_DESCRIPTION.md
- ‚úÖ Import –º–æ–¥—É–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç: `from reels import main`

#### 1.2. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (60 –º–∏–Ω)

**–§–∞–π–ª:** `reels/models/news.py`

```python
from pydantic import BaseModel, Field
from typing import Optional, List
from datetime import datetime

class News(BaseModel):
    """–í—Ö–æ–¥–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å –∏–∑ –ë–î –¢–ù–ë"""
    id: str
    title: str
    summary: str
    source: str
    url: Optional[str] = None
    published_date: str
    category: Optional[str] = None

class Enrichment(BaseModel):
    """–û–±–æ–≥–∞—â–µ–Ω–∏–µ –æ—Ç Perplexity"""
    additional_context: str
    key_facts: List[str] = Field(min_length=3, max_length=10)
    background: str
    implications: str
    related_topics: List[str]

class ProcessingMetadata(BaseModel):
    """–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"""
    processed_at: str
    tokens_used: int
    model: str

class EnrichedNews(BaseModel):
    """–ù–æ–≤–æ—Å—Ç—å –æ–±–æ–≥–∞—â–µ–Ω–Ω–∞—è —á–µ—Ä–µ–∑ Perplexity"""
    # –ë–∞–∑–æ–≤—ã–µ –ø–æ–ª—è
    id: str
    title: str
    summary: str
    source: str

    # –û–±–æ–≥–∞—â–µ–Ω–∏–µ
    enrichment: Enrichment
    processing_metadata: ProcessingMetadata
```

**–§–∞–π–ª:** `reels/models/reels.py`

```python
from pydantic import BaseModel, Field
from typing import List

class Script(BaseModel):
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è"""
    hook: str = Field(..., description="0-3 —Å–µ–∫: –ó–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–µ –Ω–∞—á–∞–ª–æ")
    main_content: str = Field(..., description="3-25 —Å–µ–∫: –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç")
    cta: str = Field(..., description="25-30 —Å–µ–∫: Call-to-action")

class ReelsScenario(BaseModel):
    """–°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è Instagram Reels"""
    news_id: str
    title: str
    duration: int = 30

    # –°—Ü–µ–Ω–∞—Ä–∏–π
    script: Script

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    visual_suggestions: List[str] = Field(min_length=3)
    hashtags: List[str] = Field(min_length=5, max_length=10)
    music_mood: str
    target_audience: str
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ú–æ–¥–µ–ª–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ú–æ–¥–µ–ª–∏ –æ—Ç–∫–ª–æ–Ω—è—é—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π –ø—Ä–æ—Ö–æ–¥—è—Ç

#### 1.3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (30 –º–∏–Ω)

**–§–∞–π–ª:** `.env` (–¥–æ–±–∞–≤–∏—Ç—å)

```bash
# Perplexity API
PERPLEXITY_API_KEY=your_key_here
```

**–§–∞–π–ª:** `config/profiles/reels.yaml`

```yaml
profile: reels

perplexity:
  api_key: ${PERPLEXITY_API_KEY}
  model: sonar-pro
  timeout: 60
  max_retries: 3
  base_url: https://api.perplexity.ai

reels_processor:
  source: database
  news_limit: 10
  filter_by_category: []

  prompts:
    enrich_news: reels/prompts/enrich_news.md
    generate_reels: reels/prompts/generate_reels.md

  auto_run_after_processor: false

output:
  telegram:
    enabled: true
    channel: ${MY_PERSONAL_ACCOUNT}
    format: detailed
  file:
    enabled: false

logging:
  level: INFO
  log_tokens: true
```

**–§–∞–π–ª:** `reels/config/reels_config.py`

```python
from utils.config import Config

class ReelsConfig:
    """–û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Reels –º–æ–¥—É–ª—è"""

    def __init__(self, config: Config):
        self.config = config

    @property
    def perplexity_api_key(self) -> str:
        return self.config.get("perplexity.api_key")

    @property
    def perplexity_model(self) -> str:
        return self.config.get("perplexity.model", "sonar-pro")

    # ... –∏ —Ç.–¥.
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: `Config("reels")`
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è
- ‚úÖ ReelsConfig –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### 1.4. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã (30 –º–∏–Ω)

**–§–∞–π–ª:** `reels/prompts/enrich_news.md`

```markdown
# –ü—Ä–æ–º–ø—Ç –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏

–¢—ã —ç–∫—Å–ø–µ—Ä—Ç-–∂—É—Ä–Ω–∞–ª–∏—Å—Ç. –ò–∑—É—á–∏ —Å–ª–µ–¥—É—é—â—É—é –Ω–æ–≤–æ—Å—Ç—å –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑.

## –ù–û–í–û–°–¢–¨

**–ó–∞–≥–æ–ª–æ–≤–æ–∫:** {title}
**–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:** {summary}
**–ò—Å—Ç–æ—á–Ω–∏–∫:** {source}
{url}

## –¢–í–û–Ø –ó–ê–î–ê–ß–ê

1. –ù–∞–π–¥–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ
2. –í—ã–¥–µ–ª–∏ 5-7 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–æ–≤
3. –û–±—ä—è—Å–Ω–∏ –ø—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—é —Å–æ–±—ã—Ç–∏—è (—á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ —ç—Ç–æ–º—É)
4. –û–ø–∏—à–∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏ –≤–ª–∏—è–Ω–∏–µ
5. –£–∫–∞–∂–∏ 3-5 —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–µ–º –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è

## –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê

–û—Ç–≤–µ—Ç—å –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:

{
  "additional_context": "–î–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è...",
  "key_facts": [
    "–§–∞–∫—Ç 1",
    "–§–∞–∫—Ç 2",
    "–§–∞–∫—Ç 3",
    "..."
  ],
  "background": "–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏—è...",
  "implications": "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è...",
  "related_topics": ["–¢–µ–º–∞ 1", "–¢–µ–º–∞ 2", "..."]
}

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¢–û–õ–¨–ö–û JSON, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
```

**–§–∞–π–ª:** `reels/prompts/generate_reels.md`

```markdown
# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è Reels

–¢—ã –∫—Ä–µ–∞—Ç–æ—Ä –≤–∏—Ä—É—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è Instagram Reels. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è 30-—Å–µ–∫—É–Ω–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ—Å—Ç–∏.

## –û–ë–û–ì–ê–©–ï–ù–ù–ê–Ø –ù–û–í–û–°–¢–¨

{enriched_news_json}

## –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –°–¶–ï–ù–ê–†–ò–Æ

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –†–æ–≤–Ω–æ 30 —Å–µ–∫—É–Ω–¥

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
1. **Hook (0-3 —Å–µ–∫):** –ó–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–µ –Ω–∞—á–∞–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–∫—Ä–æ–ª–ª
   - –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ç—Ä–∏–≥—É, —à–æ–∫–∏—Ä—É—é—â–∏–π —Ñ–∞–∫—Ç –∏–ª–∏ –≤–æ–ø—Ä–æ—Å
   - –ú–∞–∫—Å–∏–º—É–º 10-15 —Å–ª–æ–≤

2. **Main Content (3-25 —Å–µ–∫):** –°—É—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ —Å —Å–∞–º—ã–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ —Ñ–∞–∫—Ç–∞–º–∏
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–∞—á–∞
   - –î–∏–Ω–∞–º–∏—á–Ω–æ–µ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
   - 80-100 —Å–ª–æ–≤

3. **CTA (25-30 —Å–µ–∫):** –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–æ–¥–ø–∏—Å–∫–∞
   - 10-15 —Å–ª–æ–≤

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- 5-7 –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (—á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ)
- 5-7 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö—ç—à—Ç–µ–≥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ (—ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è/—Å–ø–æ–∫–æ–π–Ω–∞—è/–¥—Ä–∞–º–∞—Ç–∏—á–Ω–∞—è/–º–æ—Ç–∏–≤–∏—Ä—É—é—â–∞—è)
- –û–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏

## –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê

–û—Ç–≤–µ—Ç—å –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:

{
  "hook": "–ó–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π hook...",
  "main_content": "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç...",
  "cta": "–ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é...",
  "visual_suggestions": [
    "–í–∏–∑—É–∞–ª 1",
    "–í–∏–∑—É–∞–ª 2",
    "..."
  ],
  "hashtags": ["#—Ö—ç—à—Ç–µ–≥1", "#—Ö—ç—à—Ç–µ–≥2", "..."],
  "music_mood": "—ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è",
  "target_audience": "–û–ø–∏—Å–∞–Ω–∏–µ –¶–ê"
}

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¢–û–õ–¨–ö–û JSON, –±–µ–∑ markdown –±–ª–æ–∫–æ–≤ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã ({title}, {enriched_news_json})
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã —á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `Path().read_text()`

### –ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≠—Ç–∞–ø–∞ 1

- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ö–æ–º–º–∏—Ç: "feat(reels): –≠—Ç–∞–ø 1 ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è"

---

## üìã –≠–¢–ê–ü 2: PERPLEXITY API –ö–õ–ò–ï–ù–¢

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 1

### –ó–∞–¥–∞—á–∏

#### 2.1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç (60 –º–∏–Ω)

**–§–∞–π–ª:** `reels/services/perplexity_client.py`

```python
import json
import logging
from pathlib import Path
from typing import Dict, Any

import aiohttp
from tenacity import (
    retry,
    stop_after_attempt,
    wait_exponential,
    retry_if_exception_type
)

from reels.models.news import News, EnrichedNews, Enrichment, ProcessingMetadata
from reels.models.reels import ReelsScenario, Script
from reels.config.reels_config import ReelsConfig

logger = logging.getLogger(__name__)

class PerplexityClient:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Perplexity API"""

    def __init__(self, config: ReelsConfig):
        self.config = config
        self.api_key = config.perplexity_api_key
        self.model = config.perplexity_model
        self.base_url = "https://api.perplexity.ai"
        self.timeout = config.config.get("perplexity.timeout", 60)

    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=2, max=10),
        retry=retry_if_exception_type((aiohttp.ClientError, TimeoutError))
    )
    async def _make_request(self, messages: list[dict]) -> dict:
        """–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ Perplexity API —Å retry –ª–æ–≥–∏–∫–æ–π"""
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }

        payload = {
            "model": self.model,
            "messages": messages
        }

        async with aiohttp.ClientSession() as session:
            async with session.post(
                f"{self.base_url}/chat/completions",
                headers=headers,
                json=payload,
                timeout=aiohttp.ClientTimeout(total=self.timeout)
            ) as response:
                response.raise_for_status()
                data = await response.json()
                logger.info(f"Perplexity API —É—Å–ø–µ—à–Ω–æ –≤—ã–∑–≤–∞–Ω, —Ç–æ–∫–µ–Ω—ã: {data.get('usage', {})}")
                return data

    def _load_prompt(self, prompt_key: str) -> str:
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞"""
        prompt_path = self.config.config.get(f"reels_processor.prompts.{prompt_key}")
        return Path(prompt_path).read_text(encoding='utf-8')

    def _build_prompt(self, template: str, context: dict) -> str:
        """–ü–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ–º–ø—Ç"""
        return template.format(**context)

    async def enrich_news(self, news: News) -> EnrichedNews:
        """–û–±–æ–≥–∞—Ç–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–µ—Ç–∞–ª—è–º–∏"""
        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç
        template = self._load_prompt("enrich_news")

        # –ü–æ–¥—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
        context = {
            "title": news.title,
            "summary": news.summary,
            "source": news.source,
            "url": f"**URL:** {news.url}" if news.url else ""
        }
        prompt = self._build_prompt(template, context)

        # –í—ã–∑–≤–∞—Ç—å API
        messages = [{"role": "user", "content": prompt}]
        response = await self._make_request(messages)

        # –ò–∑–≤–ª–µ—á—å –∏ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç
        content = response['choices'][0]['message']['content']
        enrichment_data = self._parse_json_response(content)

        # –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Pydantic
        enrichment = Enrichment(**enrichment_data)

        # –°–æ–±—Ä–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
        metadata = ProcessingMetadata(
            processed_at=datetime.utcnow().isoformat(),
            tokens_used=response['usage']['total_tokens'],
            model=self.model
        )

        return EnrichedNews(
            id=news.id,
            title=news.title,
            summary=news.summary,
            source=news.source,
            enrichment=enrichment,
            processing_metadata=metadata
        )

    async def generate_reels_scenario(self, enriched_news: EnrichedNews) -> ReelsScenario:
        """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π Reels"""
        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç
        template = self._load_prompt("generate_reels")

        # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
        enriched_json = enriched_news.model_dump_json(indent=2)
        prompt = self._build_prompt(template, {"enriched_news_json": enriched_json})

        # –í—ã–∑–≤–∞—Ç—å API
        messages = [{"role": "user", "content": prompt}]
        response = await self._make_request(messages)

        # –ü–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç
        content = response['choices'][0]['message']['content']
        scenario_data = self._parse_json_response(content)

        # –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å
        script = Script(
            hook=scenario_data['hook'],
            main_content=scenario_data['main_content'],
            cta=scenario_data['cta']
        )

        return ReelsScenario(
            news_id=enriched_news.id,
            title=enriched_news.title,
            duration=30,
            script=script,
            visual_suggestions=scenario_data['visual_suggestions'],
            hashtags=scenario_data['hashtags'],
            music_mood=scenario_data['music_mood'],
            target_audience=scenario_data['target_audience']
        )

    def _parse_json_response(self, content: str) -> dict:
        """–ü–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ markdown –±–ª–æ–∫–µ)"""
        # –£–±—Ä–∞—Ç—å markdown –±–ª–æ–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
        content = content.strip()
        if content.startswith("```json"):
            content = content[7:]
        if content.startswith("```"):
            content = content[3:]
        if content.endswith("```"):
            content = content[:-3]

        try:
            return json.loads(content.strip())
        except json.JSONDecodeError as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {e}\nContent: {content}")
            raise ValueError(f"Perplexity –≤–µ—Ä–Ω—É–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON: {e}")
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ JSON –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

#### 2.2. –î–æ–±–∞–≤–∏—Ç—å rate limiting (30 –º–∏–Ω)

```python
from utils.rate_limiter import RateLimiter

class PerplexityClient:
    def __init__(self, config: ReelsConfig):
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

        # Rate limiter: 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (—É—Å–ª–æ–≤–Ω–æ)
        self._rate_limiter = RateLimiter(max_requests=60, per_seconds=60)

    async def _make_request(self, messages: list[dict]) -> dict:
        # –ñ–¥–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –æ—Ç rate limiter
        await self._rate_limiter.acquire()

        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∑–∞–ø—Ä–æ—Å–∞
```

#### 2.3. –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã (60 –º–∏–Ω)

**–§–∞–π–ª:** `reels/tests/test_perplexity_client.py`

```python
import pytest
from unittest.mock import AsyncMock, patch, MagicMock
from reels.services.perplexity_client import PerplexityClient
from reels.models.news import News

@pytest.fixture
def mock_config():
    """–ú–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    config = MagicMock()
    config.perplexity_api_key = "test_key"
    config.perplexity_model = "sonar-pro"
    config.config.get.side_effect = lambda key, default=None: {
        "perplexity.timeout": 60,
        "reels_processor.prompts.enrich_news": "reels/prompts/enrich_news.md",
        "reels_processor.prompts.generate_reels": "reels/prompts/generate_reels.md"
    }.get(key, default)
    return config

@pytest.fixture
def sample_news():
    """–¢–µ—Å—Ç–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å"""
    return News(
        id="test_001",
        title="–ù–æ–≤–∞—è AI –º–æ–¥–µ–ª—å –æ—Ç OpenAI",
        summary="–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ GPT-5...",
        source="TechCrunch",
        published_date="2025-10-20T10:00:00Z"
    )

@pytest.mark.asyncio
async def test_enrich_news_success(mock_config, sample_news):
    """–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–æ–≥–∞—â–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏"""
    client = PerplexityClient(mock_config)

    # –ú–æ–∫ API –æ—Ç–≤–µ—Ç–∞
    mock_response = {
        'choices': [{
            'message': {
                'content': '''
                {
                    "additional_context": "–ö–æ–Ω—Ç–µ–∫—Å—Ç...",
                    "key_facts": ["–§–∞–∫—Ç 1", "–§–∞–∫—Ç 2", "–§–∞–∫—Ç 3"],
                    "background": "–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è...",
                    "implications": "–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è...",
                    "related_topics": ["AI", "GPT"]
                }
                '''
            }
        }],
        'usage': {'total_tokens': 500}
    }

    with patch.object(client, '_make_request', new=AsyncMock(return_value=mock_response)):
        enriched = await client.enrich_news(sample_news)

        assert enriched.id == sample_news.id
        assert enriched.title == sample_news.title
        assert len(enriched.enrichment.key_facts) == 3
        assert enriched.processing_metadata.tokens_used == 500

@pytest.mark.asyncio
async def test_enrich_news_invalid_json(mock_config, sample_news):
    """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON"""
    client = PerplexityClient(mock_config)

    mock_response = {
        'choices': [{'message': {'content': 'invalid json'}}],
        'usage': {'total_tokens': 100}
    }

    with patch.object(client, '_make_request', new=AsyncMock(return_value=mock_response)):
        with pytest.raises(ValueError, match="–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON"):
            await client.enrich_news(sample_news)

# ... –±–æ–ª—å—à–µ —Ç–µ—Å—Ç–æ–≤
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è `enrich_news()` –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è `generate_reels_scenario()` –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è error handling –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Coverage `perplexity_client.py` > 80%

### –ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≠—Ç–∞–ø–∞ 2

- ‚úÖ PerplexityClient —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Rate limiting –¥–æ–±–∞–≤–ª–µ–Ω
- ‚úÖ JSON parsing –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç > 80%
- ‚úÖ –ö–æ–º–º–∏—Ç: "feat(reels): –≠—Ç–∞–ø 2 ‚Äî Perplexity API –∫–ª–∏–µ–Ω—Ç"

---

## üìã –≠–¢–ê–ü 3: REELS PROCESSOR

**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø—ã 1, 2

### –ó–∞–¥–∞—á–∏

#### 3.1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (90 –º–∏–Ω)

**–§–∞–π–ª:** `reels/services/reels_processor.py`

```python
import asyncio
import logging
from typing import List, Tuple, Optional

from database.db import Database
from reels.models.news import News, EnrichedNews
from reels.models.reels import ReelsScenario
from reels.services.perplexity_client import PerplexityClient
from reels.config.reels_config import ReelsConfig
from utils.config import Config

logger = logging.getLogger(__name__)

class ReelsProcessor:
    """–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Reels —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π"""

    def __init__(self, config: Config):
        self.config = config
        self.reels_config = ReelsConfig(config)
        self.db = Database(config.db_path)
        self.perplexity_client = PerplexityClient(self.reels_config)

    async def process_latest_news(
        self,
        limit: int = 10,
        category: Optional[str] = None
    ) -> Tuple[List[EnrichedNews], List[ReelsScenario]]:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –ë–î

        Args:
            limit: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            category: –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

        Returns:
            –ö–æ—Ä—Ç–µ–∂ (–æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏, —Å—Ü–µ–Ω–∞—Ä–∏–∏ Reels)
        """
        logger.info(f"–ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö {limit} –Ω–æ–≤–æ—Å—Ç–µ–π")

        # –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –ë–î –¢–ù–ë
        news_list = await self._fetch_news_from_db(limit, category)
        logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ {len(news_list)} –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ –ë–î")

        enriched_news = []
        scenarios = []

        # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—É—é –Ω–æ–≤–æ—Å—Ç—å
        for news in news_list:
            try:
                enriched, scenario = await self.process_single_news(news)
                enriched_news.append(enriched)
                scenarios.append(scenario)
                logger.info(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –Ω–æ–≤–æ—Å—Ç—å: {news.id}")
            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ—Å—Ç–∏ {news.id}: {e}", exc_info=True)
                continue

        logger.info(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –£—Å–ø–µ—à–Ω–æ: {len(scenarios)}/{len(news_list)}")
        return enriched_news, scenarios

    async def process_single_news(self, news: News) -> Tuple[EnrichedNews, ReelsScenario]:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω—É –Ω–æ–≤–æ—Å—Ç—å

        Returns:
            –ö–æ—Ä—Ç–µ–∂ (–æ–±–æ–≥–∞—â–µ–Ω–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å, —Å—Ü–µ–Ω–∞—Ä–∏–π Reels)
        """
        # –®–∞–≥ 1: –û–±–æ–≥–∞—Ç–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å —á–µ—Ä–µ–∑ Perplexity
        logger.debug(f"–û–±–æ–≥–∞—â–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏: {news.title}")
        enriched = await self.perplexity_client.enrich_news(news)

        # –®–∞–≥ 2: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π Reels
        logger.debug(f"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è Reels –¥–ª—è: {news.title}")
        scenario = await self.perplexity_client.generate_reels_scenario(enriched)

        return enriched, scenario

    async def _fetch_news_from_db(
        self,
        limit: int,
        category: Optional[str]
    ) -> List[News]:
        """–ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –ë–î –¢–ù–ë"""
        # –ü–æ–ª—É—á–∏—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å
        query = """
            SELECT id, title, content as summary, channel as source, created_at as published_date
            FROM published
            WHERE date(created_at) = date('now')
            ORDER BY created_at DESC
            LIMIT ?
        """

        rows = self.db.execute_query(query, (limit,))

        news_list = []
        for row in rows:
            news = News(
                id=str(row[0]),
                title=row[1],
                summary=row[2][:500],  # –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å summary
                source=row[3],
                published_date=row[4],
                category=category
            )
            news_list.append(news)

        return news_list

    def format_for_telegram(self, scenario: ReelsScenario) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram"""
        formatted = f"""
üé¨ **–°–¶–ï–ù–ê–†–ò–ô REELS: {scenario.title}**

üìù **ID –Ω–æ–≤–æ—Å—Ç–∏:** {scenario.news_id}
‚è±Ô∏è **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** {scenario.duration} —Å–µ–∫—É–Ω–¥

---

**üéØ HOOK (0-3 —Å–µ–∫):**
{scenario.script.hook}

**üì¢ MAIN CONTENT (3-25 —Å–µ–∫):**
{scenario.script.main_content}

**üëâ CTA (25-30 —Å–µ–∫):**
{scenario.script.cta}

---

**üé® –í–ò–ó–£–ê–õ–¨–ù–´–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø:**
{self._format_list(scenario.visual_suggestions)}

**#Ô∏è‚É£ –•–≠–®–¢–ï–ì–ò:**
{' '.join(scenario.hashtags)}

**üéµ –ù–ê–°–¢–†–û–ï–ù–ò–ï –ú–£–ó–´–ö–ò:** {scenario.music_mood}

**üë• –¶–ï–õ–ï–í–ê–Ø –ê–£–î–ò–¢–û–†–ò–Ø:** {scenario.target_audience}
"""
        return formatted.strip()

    def _format_list(self, items: List[str]) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å –±—É–ª–ª–µ—Ç–∞–º–∏"""
        return '\n'.join(f"‚Ä¢ {item}" for item in items)

    async def send_to_moderation(self, scenarios: List[ReelsScenario]):
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ Telegram –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏"""
        if not self.config.get("output.telegram.enabled", True):
            logger.info("–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram –æ—Ç–∫–ª—é—á–µ–Ω–∞")
            return

        channel = self.config.get("output.telegram.channel")
        if not channel:
            logger.warning("Telegram –∫–∞–Ω–∞–ª –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω")
            return

        logger.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ {len(scenarios)} —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ {channel}")

        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ TelegramClient –∏–∑ –¢–ù–ë
        # –í—Ä–µ–º–µ–Ω–Ω–æ: –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
        for scenario in scenarios:
            formatted = self.format_for_telegram(scenario)
            logger.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è:\n{formatted}")
            # await telegram_client.send_message(channel, formatted)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Telegram –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

#### 3.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram (60 –º–∏–Ω)

–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¢–ù–ë.

```python
from services.telegram_listener import TelegramListener
from telethon import TelegramClient

class ReelsProcessor:
    async def send_to_moderation(self, scenarios: List[ReelsScenario]):
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ Telegram –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏"""
        # ... –ø—Ä–æ–≤–µ—Ä–∫–∏

        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π TelegramClient –∏–∑ –¢–ù–ë
        async with TelegramClient(
            self.config.session_file,
            self.config.api_id,
            self.config.api_hash
        ) as client:
            for scenario in scenarios:
                formatted = self.format_for_telegram(scenario)
                await client.send_message(channel, formatted)
                logger.info(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –Ω–æ–≤–æ—Å—Ç–∏ {scenario.news_id}")
                await asyncio.sleep(1)  # Rate limiting
```

#### 3.3. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã (60 –º–∏–Ω)

**–§–∞–π–ª:** `reels/tests/test_reels_processor.py`

```python
import pytest
from unittest.mock import AsyncMock, MagicMock, patch
from reels.services.reels_processor import ReelsProcessor
from reels.models.news import News, EnrichedNews, Enrichment, ProcessingMetadata
from reels.models.reels import ReelsScenario, Script

# ... —Ñ–∏–∫—Å—Ç—É—Ä—ã

@pytest.mark.asyncio
async def test_process_single_news():
    """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏"""
    # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

@pytest.mark.asyncio
async def test_process_latest_news():
    """–¢–µ—Å—Ç batch –æ–±—Ä–∞–±–æ—Ç–∫–∏"""
    # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

@pytest.mark.asyncio
async def test_format_for_telegram():
    """–¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Telegram"""
    # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
```

### –ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≠—Ç–∞–ø–∞ 3

- ‚úÖ ReelsProcessor —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î –¢–ù–ë —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Telegram –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç > 70%
- ‚úÖ –ö–æ–º–º–∏—Ç: "feat(reels): –≠—Ç–∞–ø 3 ‚Äî Reels Processor"

---

## üìã –≠–¢–ê–ü 4: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í MAIN.PY

**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø—ã 1-3

### –ó–∞–¥–∞—á–∏

#### 4.1. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º "reels" (45 –º–∏–Ω)

**–§–∞–π–ª:** `main.py` (–∏–∑–º–µ–Ω–µ–Ω–∏—è)

```python
def parse_args(argv: list[str]) -> argparse.Namespace:
    parser = argparse.ArgumentParser(description="TG News Bot")
    parser.add_argument(
        "mode",
        nargs="?",
        choices=["listener", "processor", "reels", "all"],  # ‚Üê –î–û–ë–ê–í–ò–¢–¨
        default="all",
        help="–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞",
    )
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ
```

```python
async def run_reels_mode(config: Config | None = None):
    """–ó–∞–ø—É—Å–∫ Reels Generator (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π)"""
    config = config or get_container().config
    configure_logging(config)

    logger.info("=" * 80)
    logger.info("üé¨ –ó–ê–ü–£–°–ö REELS GENERATOR")
    logger.info("=" * 80)

    from reels.services.reels_processor import ReelsProcessor

    processor = ReelsProcessor(config)

    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
    limit = config.get("reels_processor.news_limit", 10)
    category = config.get("reels_processor.filter_by_category")

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
    enriched_news, scenarios = await processor.process_latest_news(limit, category)

    # –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
    if scenarios:
        await processor.send_to_moderation(scenarios)
        logger.info(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(scenarios)} –Ω–æ–≤–æ—Å—Ç–µ–π")
    else:
        logger.warning("‚ö†Ô∏è –ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
```

```python
async def main_async(argv: list[str] = None):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

    if args.mode == "reels":
        await run_reels_mode(config)
    elif args.mode == "listener":
        await run_listener_mode(config)
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ
```

#### 4.2. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ processor (30 –º–∏–Ω)

```python
async def run_processor_mode(config: Config | None = None):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏

    # –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
    logger.info("–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É")

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–µ–Ω –ª–∏ –∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫ reels
    if config.get("reels_processor.auto_run_after_processor", False):
        logger.info("–ê–≤—Ç–æ-–∑–∞–ø—É—Å–∫ Reels Generator...")
        await run_reels_mode(config)
```

#### 4.3. –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç (30 –º–∏–Ω)

```python
@pytest.mark.integration
async def test_main_reels_mode():
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Ä–µ–∂–∏–º–∞ reels"""
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å main —Å —Ä–µ–∂–∏–º–æ–º "reels"
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã
```

### –ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≠—Ç–∞–ø–∞ 4

- ‚úÖ –†–µ–∂–∏–º `python main.py reels` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ-–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ processor —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç
- ‚úÖ –ö–æ–º–º–∏—Ç: "feat(reels): –≠—Ç–∞–ø 4 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main.py"

---

## üìã –≠–¢–ê–ü 5: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø—ã 1-4

### –ó–∞–¥–∞—á–∏

#### 5.1. –£–≤–µ–ª–∏—á–∏—Ç—å coverage –¥–æ >70% (90 –º–∏–Ω)

- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è edge cases
- –¢–µ—Å—Ç—ã –¥–ª—è error handling
- –¢–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

#### 5.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã end-to-end (60 –º–∏–Ω)

```python
@pytest.mark.integration
async def test_full_pipeline():
    """–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ë–î ‚Üí Perplexity ‚Üí Telegram"""
    # 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –Ω–æ–≤–æ—Å—Ç—å –≤ –ë–î
    # 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å processor
    # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram
```

#### 5.3. Coverage report (30 –º–∏–Ω)

```bash
pytest reels/ --cov=reels --cov-report=html --cov-report=term
```

### –ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≠—Ç–∞–ø–∞ 5

- ‚úÖ Coverage > 70%
- ‚úÖ –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Coverage report —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ö–æ–º–º–∏—Ç: "test(reels): –≠—Ç–∞–ø 5 ‚Äî –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"

---

## üìã –≠–¢–ê–ü 6: –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø—ã 1-5

### –ó–∞–¥–∞—á–∏

#### 6.1. README –¥–ª—è –º–æ–¥—É–ª—è (45 –º–∏–Ω)

**–§–∞–π–ª:** `reels/README.md`

- –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- API reference
- FAQ

#### 6.2. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (30 –º–∏–Ω)

**–§–∞–π–ª:** `reels/examples/`

- `basic_usage.py` ‚Äî –±–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- `custom_prompts.py` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- `batch_processing.py` ‚Äî –º–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

#### 6.3. API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (30 –º–∏–Ω)

–î–æ–±–∞–≤–∏—Ç—å docstrings –≤–µ–∑–¥–µ, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å API docs.

### –ò—Ç–æ–≥–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≠—Ç–∞–ø–∞ 6

- ‚úÖ README –ø–æ–ª–Ω—ã–π
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞
- ‚úÖ –ö–æ–º–º–∏—Ç: "docs(reels): –≠—Ç–∞–ø 6 ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò –ü–†–û–ï–ö–¢–ê

### Must Have (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

- ‚úÖ –í—Å–µ 6 —ç—Ç–∞–ø–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
- ‚úÖ Coverage > 70%
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (unit + integration)
- ‚úÖ `python main.py reels --profile reels` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ README –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω—ã–µ
- ‚úÖ –ö–æ–¥ –ø—Ä–æ—à–µ–ª review

### Nice to Have (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

- ‚è≥ Coverage > 80%
- ‚è≥ Performance —Ç–µ—Å—Ç—ã
- ‚è≥ –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö use cases
- ‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚è≥ Dashboard –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

## üìä –ü–†–û–ì–†–ï–°–°

| –≠—Ç–∞–ø | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–≥—Ä–µ—Å—Å | –í—Ä–µ–º—è |
|------|--------|----------|-------|
| 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | üî® | 0% | 0/3 —á |
| 2. Perplexity Client | ‚è≥ | 0% | 0/3 —á |
| 3. Reels Processor | ‚è≥ | 0% | 0/4 —á |
| 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è main.py | ‚è≥ | 0% | 0/2 —á |
| 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚è≥ | 0% | 0/3 —á |
| 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚è≥ | 0% | 0/2 —á |
| **–ò–¢–û–ì–û** | üî® | **0%** | **0/17 —á** |

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. –ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
2. –û–±–Ω–æ–≤–ª—è—Ç—å PROGRESS.md –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
3. –î–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç—ã –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
4. –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-10-20
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Claude Code

