# üìú –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º

## üö´ –ß—Ç–æ –ù–ï —Ç—Ä–æ–≥–∞—Ç—å

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **database/db.py**: –£–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (WAL, timeout 30s, thread-safe)
- **Timezone –ª–æ–≥–∏–∫–∞**: –í—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ UTC, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **Telegram sessions**: Listener –∏—Å–ø–æ–ª—å–∑—É–µ—Ç User API, status reporter - Bot API (—Ä–∞–∑–¥–µ–ª–µ–Ω—ã)
- **Embeddings –º–æ–¥–µ–ª—å**: `paraphrase-multilingual-MiniLM-L12-v2` - –Ω–µ –º–µ–Ω—è—Ç—å –±–µ–∑ —Ç–µ—Å—Ç–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **config.yaml**: –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è utils/config.py
- **.env**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .env.example –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤
- **Docker**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Dockerfile —Ç—Ä–µ–±—É—é—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ (15 –º–∏–Ω)

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **PyTorch**: –£–∂–µ –≤ requirements.txt, –∑–∞–Ω–∏–º–∞–µ—Ç 2GB –≤ –æ–±—Ä–∞–∑–µ
- **Telethon vs Pyrogram**: –ò—Å–ø–æ–ª—å–∑—É–µ–º Telethon, –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å
- **Gemini API**: –ú–æ–¥–µ–ª—å `gemini-2.0-flash-exp` - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è, –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è

---

## ‚úÖ –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∞—Ç—å

### –ö–æ–¥
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ marketplace_processor.py (–±–æ–ª—å—à–æ–π —Ñ–∞–π–ª)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ docstrings
- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞
- –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç—ã
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ (test_*.py)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tempfile.NamedTemporaryFile –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ edge cases

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ embeddings
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

---

## üéØ –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞

### Python
- **–°—Ç–∏–ª—å**: PEP 8, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ ruff
- **Docstrings**: Google style
- **Type hints**: –í–µ–∑–¥–µ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- **Imports**: –ü–æ—Ä—è–¥–æ–∫ - stdlib, third-party, local

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ
- **–§—É–Ω–∫—Ü–∏–∏**: snake_case
- **–ö–ª–∞—Å—Å—ã**: PascalCase
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã**: UPPER_CASE
- **Private –º–µ—Ç–æ–¥—ã**: _leading_underscore

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –•–û–†–û–®–û:
logger.info(f"Processed {count} messages")

# –ü–õ–û–•–û:
print(f"Processed {count} messages")
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
# –•–û–†–û–®–û:
try:
    result = api_call()
except SpecificException as e:
    logger.error(f"API failed: {e}")
    raise

# –ü–õ–û–•–û:
try:
    result = api_call()
except:
    pass
```

---

## üîÑ Workflow

### –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å DOROZHNAYA_KARTA.md
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
3. –°–¥–µ–ª–∞—Ç—å backup –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### –í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
1. –î–µ–ª–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–µ –∫–æ–º–º–∏—Ç—ã
2. –ü–∏—Å–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ commit messages
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã: `python -m pytest`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä: `ruff check .`
3. –û–±–Ω–æ–≤–∏—Ç—å DOROZHNAYA_KARTA.md
4. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Å –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Database locked
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –ø–∏—Å–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
**–†–µ—à–µ–Ω–∏–µ**: –£–∂–µ —Ä–µ—à–µ–Ω–æ –≤ A4 - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —Å–≤–æ–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º

### Session conflicts
**–ü—Ä–∏—á–∏–Ω–∞**: User API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
**–†–µ—à–µ–Ω–∏–µ**: –£–∂–µ —Ä–µ—à–µ–Ω–æ –≤ B6 - status reporter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Bot API

### Gemini quota exceeded
**–ü—Ä–∏—á–∏–Ω–∞**: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: 
- –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –¥–µ—à—ë–≤—É—é –º–æ–¥–µ–ª—å
- –î–æ–±–∞–≤–∏—Ç—å rate limiting

### Embeddings –º–µ–¥–ª–µ–Ω–Ω—ã–µ
**–ü—Ä–∏—á–∏–Ω–∞**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
**–†–µ—à–µ–Ω–∏–µ**: B1 - batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–≤ roadmap)

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Baseline (–¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π: ~30-40 –º–∏–Ω—É—Ç
- Embeddings: ~2-3 —Å–µ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- Gemini –∑–∞–ø—Ä–æ—Å: ~5-10 —Å–µ–∫ –Ω–∞ batch

### –¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–ø–æ—Å–ª–µ B1)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π: ~10-15 –º–∏–Ω—É—Ç
- Embeddings: ~0.5 —Å–µ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ (batch)
- Gemini –∑–∞–ø—Ä–æ—Å: —Ç–æ—Ç –∂–µ (~5-10 —Å–µ–∫)

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### API –∫–ª—é—á–∏
- –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ .env
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
- –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ Git
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å

### Telegram
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–Ω–µ –ª–∏—á–Ω—ã–π)
- Session —Ñ–∞–π–ª—ã = –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É
- –ù–µ —à–∞—Ä–∏—Ç—å session —Ñ–∞–π–ª—ã

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –•—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ data/
- Backup –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-10-12
**–í–µ—Ä—Å–∏—è**: 1.0
